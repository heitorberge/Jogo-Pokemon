<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jogo Pokémon</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
        font-family: 'Press Start 2P', cursive;
        background-color: #f5f5f5;
        color: #333;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background-image: url('https://images.nintendolife.com/a5b945f16b994/1280x720.jpg');
        background-size: cover;
        background-position: center;
    }

    #container {
        background-color: rgba(255, 255, 255, 0.8);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        max-width: 80%;
        width: 400px;
    }

    h1 {
        font-size: 24px;
        margin-bottom: 20px;
        color: #ffcb05;
        -webkit-text-stroke: 1px #3b4cca;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    #message-box {
        background-color: #e0f7fa;
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 5px;
        text-align: center;
        font-size: 14px;
        color: #00897b;
        border: 1px solid #b2ebf2;
    }

    #pokemon-list {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 20px;
        max-height: 200px;
        overflow-y: auto;
    }

    #pokemon-list button {
        background-color: #ffcb05;
        color: #3b4cca;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        margin: 5px;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.3s, transform 0.2s;
        font-family: 'Press Start 2P', cursive;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        width: 100%;
        text-align: center;
    }

    #pokemon-list button:hover {
        background-color: #e6b800;
        transform: scale(1.1);
    }

    #pokemon-card {
        background-color: #fff;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: none;
        text-align: center;
    }

    #pokemon-card img {
        width: 150px;
        height: auto;
        margin-bottom: 10px;
    }

    #pokemon-card h2 {
        font-size: 18px;
        margin-bottom: 5px;
        color: #3b4cca;
    }

    #pokemon-card p {
        font-size: 14px;
        margin-bottom: 5px;
    }

    #battle-section {
        display: none;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #battle-section h2 {
        font-size: 20px;
        margin-bottom: 10px;
        color: #ff4444;
    }

    #battle-info {
        display: flex;
        justify-content: space-around;
        margin-bottom: 20px;
        text-align: left;
    }

    #battle-info div {
        background-color: #f0f0f0;
        padding: 10px;
        border-radius: 5px;
        width: 40%;
    }

    #battle-info h3 {
        font-size: 16px;
        margin-bottom: 5px;
        color: #333;
    }

    #battle-buttons {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }

    #battle-buttons button {
        background-color: #ff4444;
        color: #fff;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        margin: 5px;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.3s, transform 0.2s;
        width: 100px;
    }

    #battle-buttons button:hover {
        background-color: #cc0000;
        transform: scale(1.1);
    }

    #pokedex-container {
        display: none;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        max-width: 90%;
        margin: 20px auto;
    }

    #pokedex-list {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 20px;
        max-height: 300px;
        overflow-y: auto;
    }

    #pokedex-list li {
        background-color: #fff;
        border-radius: 5px;
        padding: 10px;
        margin: 5px;
        width: 150px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        list-style: none;
        font-size: 12px;
        color: #333;
    }

    #pokedex-list li img {
        width: 100px;
        height: auto;
        margin-bottom: 5px;
    }

    #pokedex-list li h3 {
        font-size: 14px;
        margin-bottom: 5px;
        color: #3b4cca;
    }

    #pokedex-list li p {
        font-size: 10px;
        color: #666;
    }

    #show-pokedex {
        background-color: #ffcb05;
        color: #3b4cca;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        margin: 20px auto;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.3s, transform 0.2s;
        font-family: 'Press Start 2P', cursive;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: block;
        width: 200px;
        text-align: center;
    }

    #show-pokedex:hover {
        background-color: #e6b800;
        transform: scale(1.1);
    }

    #close-pokedex {
        background-color: #3b4cca;
        color: #fff;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        margin-top: 10px;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.3s, transform 0.2s;
        font-family: 'Press Start 2P', cursive;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: none;
        width: 200px;
        text-align: center;
    }

    #close-pokedex:hover {
        background-color: #283593;
        transform: scale(1.1);
    }

    .shiny {
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    #pokemon-selection {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 20px;
    }

    #pokemon-selection label {
        margin-bottom: 10px;
        font-size: 14px;
        color: #333;
    }

    #pokemon-dropdown {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        width: 200px;
        font-size: 12px;
        font-family: 'Press Start 2P', cursive;
        margin-bottom: 10px;
    }

    #start-battle-btn {
        background-color: #ff4444;
        color: #fff;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.3s, transform 0.2s;
        font-family: 'Press Start 2P', cursive;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        width: 200px;
        text-align: center;
    }

    #start-battle-btn:hover {
        background-color: #cc0000;
        transform: scale(1.1);
    }

    #attack-button, #heal-button, #catch-button, #run-button {
        width: 120px;
    }

    #random-pokemon-btn {
        background-color: #8884d8; /* Um tom de roxo */
        color: #fff;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        margin: 10px auto; /* Centraliza o botão */
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.3s, transform 0.2s;
        font-family: 'Press Start 2P', cursive;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: block; /* Garante que o botão ocupe a largura total disponível */
        width: 200px; /* Define a largura do botão */
        text-align: center; /* Centraliza o texto dentro do botão */
    }

    #random-pokemon-btn:hover {
        background-color: #673ab7; /* Um tom de roxo mais escuro */
        transform: scale(1.1);
    }

    @media (max-width: 600px) {
        #container {
            width: 95%;
        }
        #pokemon-list button,
        #pokemon-dropdown,
        #start-battle-btn,
        #show-pokedex,
        #close-pokedex,
        #random-pokemon-btn {
            width: 100%;
            margin: 5px 0;
        }
        #battle-buttons button {
            width: 100%;
            margin: 5px 0;
        }
        #battle-info {
            flex-direction: column;
        }
        #battle-info div {
            width: 100%;
            margin-bottom: 10px;
        }
    }
  </style>
</head>
<body>
<div id="container">
  <h1>Jogo Pokémon</h1>
  <div id="message-box">Bem-vindo ao mundo Pokémon! Escolha um Pokémon para começar sua jornada!</div>
  <div id="pokemon-selection">
    <label for="pokemon-dropdown">Escolha seu Pokémon:</label>
    <select id="pokemon-dropdown"></select>
    <button id="start-battle-btn">Iniciar Batalha</button>
    <button id="random-pokemon-btn">Escolher Aleatório</button> </div>
  <div id="pokemon-list">
  </div>
  <div id="pokemon-card">
    <img id="pokemon-image" src="" alt="">
    <h2 id="pokemon-name">Nome do Pokémon</h2>
    <p id="pokemon-type">Tipo: </p>
    <p id="pokemon-hp">HP: </p>
    <p id="pokemon-attack">Ataque: </p>
    <p id="pokemon-defense">Defesa: </p>
    <p id="pokemon-special-attack">Ataque Especial: </p>
    <p id="pokemon-special-defense">Defesa Especial: </p>
    <p id="pokemon-speed">Velocidade: </p>
  </div>

  <div id="battle-section">
    <h2>Batalha Pokémon</h2>
    <div id="battle-info">
      <div id="player-pokemon-info">
        <h3>Seu Pokémon</h3>
        <img id="player-pokemon-image" src="" alt="">
        <p id="player-pokemon-name">Nome: </p>
        <p id="player-pokemon-type">Tipo: </p>
        <p id="player-pokemon-hp">HP: </p>
      </div>
      <div id="opponent-pokemon-info">
        <h3>Pokémon Oponente</h3>
        <img id="opponent-pokemon-image" src="" alt="">
        <p id="opponent-pokemon-name">Nome: </p>
        <p id="opponent-pokemon-type">Tipo: </p>
        <p id="opponent-pokemon-hp">HP: </p>
      </div>
    </div>
    <div id="battle-buttons">
      <button id="attack-button">Atacar</button>
      <button id="heal-button">Curar</button>
      <button id="catch-button">Capturar</button>
      <button id="run-button">Fugir</button>
    </div>
  </div>

  <button id="show-pokedex">Ver Pokédex</button>
  <div id="pokedex-container">
    <h2>Pokédex</h2>
    <ul id="pokedex-list">
    </ul>
    <button id="close-pokedex">Fechar Pokédex</button>
  </div>

</div>

<script>
  const pokemonListElement = document.getElementById('pokemon-list');
  const pokemonCardElement = document.getElementById('pokemon-card');
  const pokemonImageElement = document.getElementById('pokemon-image');
  const pokemonNameElement = document.getElementById('pokemon-name');
  const pokemonTypeElement = document.getElementById('pokemon-type');
  const pokemonHpElement = document.getElementById('pokemon-hp');
  const pokemonAttackElement = document.getElementById('pokemon-attack');
  const pokemonDefenseElement = document.getElementById('pokemon-defense');
  const pokemonSpecialAttackElement = document.getElementById('pokemon-special-attack');
  const pokemonSpecialDefenseElement = document.getElementById('pokemon-special-defense');
  const pokemonSpeedElement = document.getElementById('pokemon-speed');
  const messageBoxElement = document.getElementById('message-box');
  const showPokedexButton = document.getElementById('show-pokedex');
  const pokedexContainer = document.getElementById('pokedex-container');
  const pokedexList = document.getElementById('pokedex-list');
  const closePokedexButton = document.getElementById('close-pokedex');
  const pokemonDropdown = document.getElementById('pokemon-dropdown');
  const startBattleButton = document.getElementById('start-battle-btn');
  const randomPokemonButton = document.getElementById('random-pokemon-btn'); // Botão Adicionado

  // Elementos da seção de batalha
  const battleSection = document.getElementById('battle-section');
  const playerPokemonInfoElement = document.getElementById('player-pokemon-info');
  const opponentPokemonInfoElement = document.getElementById('opponent-pokemon-info');
  const playerPokemonImageElement = document.getElementById('player-pokemon-image');
  const playerPokemonNameElement = document.getElementById('player-pokemon-name');
  const playerPokemonTypeElement = document.getElementById('player-pokemon-type');
  const playerPokemonHpElement = document.getElementById('player-pokemon-hp');
  const opponentPokemonImageElement = document.getElementById('opponent-pokemon-image');
  const opponentPokemonNameElement = document.getElementById('opponent-pokemon-name');
  const opponentPokemonTypeElement = document.getElementById('opponent-pokemon-type');
  const opponentPokemonHpElement = document.getElementById('opponent-pokemon-hp');
  const attackButton = document.getElementById('attack-button');
  const healButton = document.getElementById('heal-button');
  const catchButton = document.getElementById('catch-button');
  const runButton = document.getElementById('run-button');

  let allPokemonData = [];
  let playerPokemon = null;
  let opponentPokemon = null;
  let playerPokemons = [];
  let battleLog = [];
  let isFirstBattle = true;
  let selectedPokemonName = null;

  const initialPokemonList = [
      'bulbasaur', 'ivysaur', 'venusaur', 'charmander', 'charmeleon', 'charizard', 'squirtle', 'wartortle', 'blastoise',
      'pikachu', 'eevee', 'jolteon', 'vaporeon', 'flareon', 'snorlax', 'mewtwo', 'articuno', 'zapdos', 'moltres',
      'dragonite', 'mew', 'celebi', 'lugia', 'ho-oh', 'treecko', 'grovyle', 'sceptile', 'torchic', 'combusken',
      'blaziken', 'mudkip', 'marshtomp', 'swampert', 'gardevoir', 'salamence', 'metagross', 'latias', 'latios',
      'kyogre', 'groudon', 'rayquaza', 'jirachi', 'deoxys', 'turtwig', 'grotle', 'torterra', 'chimchar', 'monferno',
      'infernape', 'piplup', 'prinplup', 'empoleon', 'garchomp', 'lucario', 'dialga', 'palkia', 'heatran', 'regigigas',
      'giratina', 'cresselia', 'darkrai', 'shaymin', 'arceus', 'victini', 'snivy', 'servine', 'serperior', 'tepig',
      'pignite', 'emboar', 'oshawott', 'dewott', 'samurott', 'zoroark', 'cinccino', 'haxorus', 'volcarona', 'keldeo',
      'genesect', 'chespin', 'quilladin', 'chesnaught', 'fennekin', 'braixen', 'delphox', 'froakie', 'frogadier',
      'greninja', 'talonflame', 'hawlucha', 'noivern', 'xerneas', 'yveltal', 'zygarde', 'diancie', 'hoopa', 'volcanion',
      'rowlet', 'dartrix', 'decidueye', 'litten', 'torracat', 'incineroar', 'popplio', 'brionne', 'primarina', 'lycanroc',
      'mimikyu', 'togedemaru', 'necrozma', 'solgaleo', 'lunala', 'marshadow', 'zeraora', 'melmetal', 'grookey', 'thwackey',
      'rillaboom', 'scorbunny', 'raboot', 'cinderace', 'sobble', 'drizzile', 'inteleon', 'zacian', 'zamazenta', 'eternatus',
      'urshifu', 'zarude', 'regidrago', 'glastrier', 'spectrier', 'calyrex', 'wyrdeer', 'kleavor', 'ursaluna', 'basculegion',
      'sneasler', 'overqwil', 'enamorus', 'sprigatito', 'floragato', 'meowscarada', 'fuecoco', 'crocalor', 'skeledirge',
      'quaxly', 'quaxwell', 'quaquaval', 'pawmot', 'ceruledge', 'armarouge', 'koraidon', 'miraidon', 'walking-wake', 'iron-leaves'
  ];

  async function getPokemonData(pokemonName) {
      try {
          const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonName}`);
          const data = await response.json();
          return data;
      } catch (error) {
          console.error('Erro ao buscar dados do Pokémon:', error);
          messageBoxElement.textContent = `Erro ao buscar dados do Pokémon ${pokemonName}.`;
          return null;
      }
  }

  function displayPokemonDetails(pokemonData) {
      if (!pokemonData) {
          pokemonCardElement.style.display = 'none';
          return;
      }

      const isShiny = Math.random() < 0.1;
      pokemonImageElement.src = isShiny ? pokemonData.sprites.front_shiny : pokemonData.sprites.front_default;
      pokemonImageElement.alt = isShiny ? `Pokémon ${pokemonData.name} Shiny` : `Pokémon ${pokemonData.name}`;
      pokemonNameElement.textContent = pokemonData.name;
      pokemonTypeElement.textContent = `Tipo: ${pokemonData.types.map(type => type.type.name).join(', ')}`;
      pokemonHpElement.textContent = `HP: ${pokemonData.stats.find(stat => stat.stat.name === 'hp').base_stat}`;
      pokemonAttackElement.textContent = `Ataque: ${pokemonData.stats.find(stat => stat.stat.name === 'attack').base_stat}`;
      pokemonDefenseElement.textContent = `Defesa: ${pokemonData.stats.find(stat => stat.stat.name === 'defense').base_stat}`;
      pokemonSpecialAttackElement.textContent = `Ataque Especial: ${pokemonData.stats.find(stat => stat.stat.name === 'special-attack').base_stat}`;
      pokemonSpecialDefenseElement.textContent = `Defesa Especial: ${pokemonData.stats.find(stat => stat.stat.name === 'special-defense').base_stat}`;
      pokemonSpeedElement.textContent = `Velocidade: ${pokemonData.stats.find(stat => stat.stat.name === 'speed').base_stat}`;

      pokemonCardElement.style.display = 'block';
      if (isShiny) {
          pokemonImageElement.classList.add('shiny');
      } else {
          pokemonImageElement.classList.remove('shiny');
      }
  }

  async function handlePokemonClick(pokemonName) {
      if (playerPokemons.length > 0 && !playerPokemons.find(p => p.name === pokemonName)) {
          messageBoxElement.textContent = `Você só pode escolher Pokémon da sua Pokédex!`;
          return;
      }

      messageBoxElement.textContent = `Você escolheu ${pokemonName}!`;
      const pokemonData = await getPokemonData(pokemonName);
      displayPokemonDetails(pokemonData);
      playerPokemon = pokemonData;
  }

  async function initializePokemonList() {
      pokemonListElement.innerHTML = '';
      pokemonDropdown.innerHTML = '';
      allPokemonData = [];

      try {
          // Busca os dados de todos os Pokémon da API
          const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=10000');
          const data = await response.json();
          const pokemonUrls = data.results;

          // Para cada Pokémon, busca seus dados detalhados
          for (const pokemon of pokemonUrls) {
              const pokemonData = await getPokemonData(pokemon.name);
              if (pokemonData) {
                  allPokemonData.push(pokemonData);

                  // Adiciona o Pokémon ao dropdown
                  const option = document.createElement('option');
                  option.value = pokemon.name;
                  option.textContent = pokemonData.name;
                  pokemonDropdown.appendChild(option);
              }
          }

          // Se o jogador já tem Pokémon, atualiza a lista de seleção
          if (playerPokemons.length > 0) {
              pokemonDropdown.innerHTML = ''; // Limpa o dropdown
              playerPokemons.forEach(pokemon => {
                  const option = document.createElement('option');
                  option.value = pokemon.name;
                  option.textContent = pokemon.name;
                  pokemonDropdown.appendChild(option);
              });
              messageBoxElement.textContent = 'Escolha um Pokémon da sua Pokédex para a batalha!';
          } else {
              messageBoxElement.textContent = 'Escolha seu Pokémon para iniciar a batalha!';}

          // Adiciona os Pokémon iniciais à lista de seleção
          if (playerPokemons.length === 0) {
              initialPokemonList.forEach(pokemonName => {
                  const option = document.createElement('option');
                  option.value = pokemonName;
                  option.textContent = pokemonName;
                  pokemonDropdown.appendChild(option);
              });
          }

      } catch (error) {
          console.error("Erro ao inicializar lista de Pokémon:", error);
          messageBoxElement.textContent = "Erro ao carregar lista de Pokémon.";
      }
  }

  startBattleButton.addEventListener('click', async () => {
      selectedPokemonName = pokemonDropdown.value;
      const selectedPokemonData = await getPokemonData(selectedPokemonName);
      playerPokemon = selectedPokemonData;
      startBattle();
  });

  // Evento de clique do botão de escolha aleatória
  randomPokemonButton.addEventListener('click', async () => {
      const randomIndex = Math.floor(Math.random() * initialPokemonList.length);
      const randomPokemonName = initialPokemonList[randomIndex];
      const randomPokemonData = await getPokemonData(randomPokemonName);

      playerPokemon = randomPokemonData;
      displayPokemonDetails(playerPokemon);
      messageBoxElement.textContent = `Você escolheu ${randomPokemonName} aleatoriamente!`;
      startBattle();
  });

  async function startBattle() {
      if (!playerPokemon) {
          messageBoxElement.textContent = 'Por favor, escolha um Pokémon antes de iniciar a batalha.';
          return;
      }

      battleSection.style.display = 'block';
      pokemonCardElement.style.display = 'none';

      if (isFirstBattle) {
          playerPokemons.push(playerPokemon);
          updatePokedex();
          isFirstBattle = false;
      }

      const availableOpponents = allPokemonData.filter(pokemon => pokemon.name !== playerPokemon.name);
      opponentPokemon = await getRandomOpponentPokemon(availableOpponents);
      messageBoxElement.textContent = `Batalha contra ${opponentPokemon.name}!`;

      playerPokemonHp = playerPokemon.stats.find(stat => stat.stat.name === 'hp').base_stat;
      opponentPokemonHp = opponentPokemon.stats.find(stat => stat.stat.name === 'hp').base_stat;

      updateBattleInfo();
      battleLog = [];
  }

  async function getRandomOpponentPokemon(pokemonList) {
      const randomIndex = Math.floor(Math.random() * pokemonList.length);
      return pokemonList[randomIndex];
  }

  function updateBattleInfo() {
      const playerIsShiny = Math.random() < 0.1;
      const opponentIsShiny = Math.random() < 0.1;

      playerPokemonImageElement.src = playerIsShiny ? playerPokemon.sprites.front_shiny : playerPokemon.sprites.front_default;
      playerPokemonImageElement.alt = playerIsShiny ? `Pokémon ${playerPokemon.name} Shiny` : `Pokémon ${playerPokemon.name}`;
      playerPokemonNameElement.textContent = `Nome: ${playerPokemon.name}`;
      playerPokemonTypeElement.textContent = `Tipo: ${playerPokemon.types.map(type => type.type.name).join(', ')}`;
      playerPokemonHpElement.textContent = `HP: ${playerPokemonHp}/${playerPokemon.stats.find(stat => stat.stat.name === 'hp').base_stat}`;

      opponentPokemonImageElement.src = opponentIsShiny ? opponentPokemon.sprites.front_shiny : opponentPokemon.sprites.front_default;
      opponentPokemonImageElement.alt = opponentIsShiny ? `Pokémon ${opponentPokemon.name} Shiny` : `Pokémon ${opponentPokemon.name}`;
      opponentPokemonNameElement.textContent = `Nome: ${opponentPokemon.name}`;
      opponentPokemonTypeElement.textContent = `Tipo: ${opponentPokemon.types.map(type => type.type.name).join(', ')}`;
      opponentPokemonHpElement.textContent = `HP: ${opponentPokemonHp}/${opponentPokemon.stats.find(stat => stat.stat.name === 'hp').base_stat}`;
  }

  async function performAttack() {
      if (playerPokemonHp <= 0 || opponentPokemonHp <= 0) {
          messageBoxElement.textContent = 'A batalha já acabou!';
          return;
      }

      const playerAttack = playerPokemon.stats.find(stat => stat.stat.name === 'attack').base_stat;
      const opponentDefense = opponentPokemon.stats.find(stat => stat.stat.name === 'defense').base_stat;
      const damageToOpponent = Math.max(1, playerAttack - opponentDefense);
      opponentPokemonHp -= damageToOpponent;
      battleLog.push(`${playerPokemon.name} atacou ${opponentPokemon.name} e causou ${damageToOpponent} de dano!`);

      if (opponentPokemonHp <= 0) {
          battleLog.push(`${opponentPokemon.name} foi derrotado!`);
          messageBoxElement.textContent = `${playerPokemon.name} venceu a batalha! Você ganhou um novo Pokémon!`;
          playerPokemons.push(opponentPokemon);
          updatePokedex();
          battleSection.style.display = 'none';
          const newPokemon = await getRandomPokemon(allPokemonData);
          messageBoxElement.textContent += ` Seu novo Pokémon é ${newPokemon.name}!`;
          playerPokemon = newPokemon;
          playerPokemonHp = playerPokemon.stats.find(stat => stat.stat.name === 'hp').base_stat;
          initializePokemonList();
          return;
      }

      const opponentAttack = opponentPokemon.stats.find(stat => stat.stat.name === 'attack').base_stat;
      const playerDefense = playerPokemon.stats.find(stat => stat.stat.name === 'defense').base_stat;
      const damageToPlayer = Math.max(1, opponentAttack - playerDefense);
      playerPokemonHp -= damageToPlayer;
      battleLog.push(`${opponentPokemon.name} atacou ${playerPokemon.name} e causou ${damageToPlayer} de dano!`);

      if (playerPokemonHp <= 0) {
          battleLog.push(`${playerPokemon.name} foi derrotado!`);
          messageBoxElement.textContent = 'Você perdeu a batalha!';
          battleSection.style.display = 'none';
          return;
      }

      // Chance do oponente curar (bem baixa)
      if (Math.random() < 0.1) {
          const healAmount = Math.floor(opponentPokemon.stats.find(stat => stat.stat.name === 'hp').base_stat * 0.2);
          opponentPokemonHp = Math.min(opponentPokemonHp + healAmount, opponentPokemon.stats.find(stat => stat.stat.name === 'hp').base_stat);
          battleLog.push(`${opponentPokemon.name} se curou em ${healAmount} HP!`);
      }

      // Chance do oponente fugir (muito difícil)
      if (Math.random() < 0.05) {
          messageBoxElement.textContent = `${opponentPokemon.name} fugiu da batalha!`;
          battleSection.style.display = 'none';
          return;
      }

      updateBattleInfo();
      messageBoxElement.textContent = battleLog.join('\n');
  }

  function performHeal() {
      if (playerPokemonHp <= 0) {
          messageBoxElement.textContent = 'Você não pode curar um Pokémon derrotado!';
          return;
      }
      const healAmount = Math.floor(playerPokemon.stats.find(stat => stat.stat.name === 'hp').base_stat * 0.2);
      playerPokemonHp = Math.min(playerPokemonHp + healAmount, playerPokemon.stats.find(stat => stat.stat.name === 'hp').base_stat);
      updateBattleInfo();
      messageBoxElement.textContent = `${playerPokemon.name} se curou em ${healAmount} HP!`;
  }

  function performCatch() {
      if (opponentPokemonHp <= 0) {
          messageBoxElement.textContent = 'Você não pode capturar um Pokémon derrotado!';
          return;
      }

      const catchRate = 0.5 - (opponentPokemonHp / opponentPokemon.stats.find(stat => stat.stat.name === 'hp').base_stat) * 0.4;
      if (Math.random() < catchRate) {
          messageBoxElement.textContent = `${opponentPokemon.name} foi capturado!`;
          playerPokemons.push(opponentPokemon);
          updatePokedex();
          battleSection.style.display = 'none';
          return;
      } else {
          messageBoxElement.textContent = `${opponentPokemon.name} escapou!`;
      }
  }

  function performRun() {
      messageBoxElement.textContent = 'Você fugiu da batalha!';
      battleSection.style.display = 'none';
  }

  function updatePokedex() {
      pokedexList.innerHTML = '';
      playerPokemons.forEach(pokemonData => {
          const li = document.createElement('li');
          const isShiny = Math.random() < 0.1;
          const imgSrc = isShiny ? pokemonData.sprites.front_shiny : pokemonData.sprites.front_default;
          const imgAlt = isShiny ? `Pokémon ${pokemonData.name} Shiny` : `Pokémon ${pokemonData.name}`;

          li.innerHTML = `
              <img src="${imgSrc}" alt="${imgAlt}">
              <h3>${pokemonData.name}</h3>
              <p>Tipo: ${pokemonData.types.map(type => type.type.name).join(', ')}</p>
              <p>ID: ${pokemonData.id}</p>
          `;
          pokedexList.appendChild(li);
      });
      // Atualiza a lista de Pokémon no dropdown
      pokemonDropdown.innerHTML = '';
      playerPokemons.forEach(pokemon => {
          const option = document.createElement('option');
          option.value = pokemon.name;
          option.textContent = pokemon.name;
          pokemonDropdown.appendChild(option);
      });
      if (playerPokemon) {
          messageBoxElement.textContent = `Você escolheu ${playerPokemon.name}!`;
      }
      else {
          messageBoxElement.textContent = 'Escolha seu Pokémon para iniciar a batalha!';
      }
  }

  showPokedexButton.addEventListener('click', () => {
      pokedexContainer.style.display = 'block';
      showPokedexButton.style.display = 'none';
      closePokedexButton.style.display = 'block';
      updatePokedex();
  });

  closePokedexButton.addEventListener('click', () => {
      pokedexContainer.style.display = 'none';
      showPokedexButton.style.display = 'block';
      closePokedexButton.style.display = 'none';
      if (playerPokemon) {
        messageBoxElement.textContent = `Você escolheu ${playerPokemon.name}!`;
      } else {
        messageBoxElement.textContent = 'Escolha seu Pokémon para iniciar a batalha!';
      }
  });

  attackButton.addEventListener('click', performAttack);
  healButton.addEventListener('click', performHeal);
  catchButton.addEventListener('click', performCatch);
  runButton.addEventListener('click', performRun);

  initializePokemonList();
</script>
</body>
</html>
